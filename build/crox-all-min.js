/*
 Crox v1.2.0
 https://github.com/thx/crox

 Released under the MIT license
 md5: 5a132dd3cf7f740848cc8f00be859ea4
*/
(function(A){var y=function(){function y(a,d){this.row=a;this.col=d}function D(a,d){var g=a.substring(0,d),b=g.match(/\r\n?|\n/g),e=1;b&&(e+=b.length);g=1+/[^\r\n]*$/.exec(g)[0].length;return new y(e,g)}function A(a){return'"'+a.replace(/[\x00-\x1f"\\\u2028\u2029]/g,function(d){switch(d){case '"':return'\\"';case "\\":return"\\\\";case "\b":return"\\b";case "\f":return"\\f";case "\n":return"\\n";case "\r":return"\\r";case "\t":return"\\t"}return"\\u"+("000"+d.charCodeAt(0).toString(16)).slice(-4)})+
'"'}function G(a){function d(b,q,d,c){this.tag=b;this.text=q;this.index=d;this.subMatches=c}function g(){}function b(b){for(var q=1,d=[],c=[1],e=[],a=0;a<b.length;++a)c.push(q+=RegExp("|"+b[a][0].source).exec("").length),e.push(b[a][1]||g),d.push("("+b[a][0].source+")");return[RegExp(d.join("|")+"|","g"),c,e]}d.prototype.toString=function(){return this.text};var e=a.$||"$",f={},c;for(c in a)"$"!=c.charAt(0)&&(f[c]=b(a[c]));return function(b){var q=b.length,c=0,a=[""],g={text:"",index:0,source:b,pushState:function(b){a.push(b)},
popState:function(){a.pop()},retract:function(b){c-=b}};return{scan:function(){do{var s;a:{var n=f[a[a.length-1]],k=n[0];k.lastIndex=c;s=k.exec(b);if(""==s[0]){if(c<q)throw Error("lexer error: "+D(b,c)+"\n"+b.slice(c,c+50));s=new d(e,"",c)}else{g.index=c;c=k.lastIndex;for(var k=n[1],m=0;m<k.length;++m)if(s[k[m]]){n=n[2][m].apply(g,s.slice(k[m],k[m+1]));s=new d(n,s[0],g.index,s.slice(k[m]+1,k[m+1]));break a}s=void 0}}}while(null==s.tag);return s},getPos:function(c){return D(b,c)},reset:function(){c=
0;a=[""]}}}}function r(a){var d;a:{switch(a){case "id":case "lit":d=!0;break a}d=!1}return d||"."==a||"[]"==a}function h(a){return r(a)||"!"==a||"u-"==a}function v(a){if(h(a))return!0;switch(a){case "*":case "/":case "%":return!0}return!1}function w(a){if(v(a))return!0;switch(a){case "+":case "-":return!0}return!1}function x(a){if(w(a))return!0;switch(a){case "<":case ">":case "<=":case ">=":return!0}return!1}function z(a){if(x(a))return!0;switch(a){case "eq":case "ne":return!0}return!1}function B(a){return z(a)||
"&&"==a}function E(a){return B(a)||"||"==a}function I(a,d){function g(b){p+=c+b+"\n"}function b(q){for(var a=0;a<q.length;++a){var e=q[a];switch(e[0]){case "if":g("if("+f(e[1])+"){");c+="\t";b(e[2]);c=c.slice(0,-1);g("}");e[3]&&(g("else{"),c+="\t",b(e[3]),c=c.slice(0,-1),g("}"));break;case "each":var p=e[3]||"$i";g("var $list = "+f(e[1])+";");g("for(var "+p+" in $list) {");c+="\t";g("var "+e[4]+" = $list["+p+"];");b(e[2]);c=c.slice(0,-1);g("}");break;case "set":g("var "+e[1]+"="+f(e[2])+";");break;
case "eval":p=f(e[1]);e[2]&&(p=d+"("+p+")");g("$s += "+p+";");break;case "text":g("$s += "+A(e[1])+";");break;case "inc":break;default:throw Error("unknown stmt: "+e[0]);}}}function e(b,c){var e=f(b);c&&!c(b[0])&&(e="("+e+")");return e}function f(b){switch(b[0]){case "id":return b[1];case "lit":return"string"==typeof b[1]?A(b[1]):String(b[1]);case ".":return e(b[1],r)+"."+b[2];case "[]":return e(b[1],r)+"["+f(b[2])+"]";case "!":return"!"+e(b[1],h);case "u-":return"- "+e(b[1],h);case "*":case "/":case "%":return e(b[1],
v)+b[0]+e(b[2],h);case "+":case "-":return e(b[1],w)+b[0]+" "+e(b[2],v);case "<":case ">":case "<=":case ">=":return e(b[1],x)+b[0]+e(b[2],w);case "eq":case "ne":return e(b[1],z)+("eq"==b[0]?"===":"!==")+e(b[2],x);case "&&":return e(b[1],B)+"&&"+e(b[2],z);case "||":return e(b[1],E)+"||"+e(b[2],B);default:throw Error("unknown expr: "+b[0]);}}var c="\t",p="";b(a[1]);return p}function C(a){return J(K(a))}function F(a,d){var g=C(a),b;d&&(b=d.htmlEncode);var g=I(g,b||"$htmlEncode"),e="";b||(e+="var obj = { '<': '&lt;', '>': '&gt;', '&': '&amp;', '\"': '&quot;' };\n\tfunction $htmlEncode(s) {\n\t\treturn String(s).replace(/[<>&\"]/g, function(c) {\n\t\t\treturn obj[c];\n\t\t});\n\t}");
e=e+"var $s = '';"+g;e+="return $s;";return Function("root",e)}function L(a){function d(b){c+=f+b}function g(b){for(var c=0;c<b.length;++c){var a=b[c];switch(a[0]){case "if":d("if("+e(a[1])+"){");g(a[2]);d("}");a[3]&&(d("else{"),g(a[3]),d("}"));break;case "each":var f=a[3]?"$crox_"+a[3]+"=>":"";d("foreach("+e(a[1])+" as "+f+"$crox_"+a[4]+")");d("{");g(a[2]);d("}");break;case "set":d("$crox_"+a[1]+" = "+e(a[2])+";");break;case "eval":f=e(a[1]);f=a[2]?"crox_encode("+f+")":"crox_ToString("+f+")";d("echo "+
f+";");break;case "text":f=a[1];/<\?(?:php)?|\?>/.test(f)?d("echo "+("'"+String(a[1]).replace(/['\\]/g,"\\$&")+"'")+";"):d("?>"+f+"<?php ");break;case "inc":d("include '"+a[1].replace(/\.\w+$/,".php")+"';");break;default:throw Error("unknown stmt: "+a[0]);}}}function b(b,c){var a=e(b);c&&!c(b[0])&&(a="("+a+")");return a}function e(c){switch(c[0]){case "id":return"$crox_"+c[1];case "lit":return"string"==typeof c[1]?"'"+String(c[1]).replace(/['\\]/g,"\\$&")+"'":String(c[1]);case ".":return b(c[1],r)+
"->"+c[2];case "[]":return b(c[1],r)+"["+e(c[2])+"]";case "!":return"!crox_ToBoolean("+b(c[1],h)+")";case "u-":return"- "+b(c[1],h);case "*":case "/":case "%":return b(c[1],v)+c[0]+b(c[2],h);case "+":return"crox_plus("+b(c[1],null)+", "+b(c[2],null)+")";case "-":return b(c[1],w)+"- "+b(c[2],v);case "<":case ">":case "<=":case ">=":return b(c[1],x)+c[0]+b(c[2],w);case "eq":case "ne":var a="eq"==c[0]?"===":"!==";return b(c[1],z)+a+b(c[2],x);case "&&":return"crox_logical_and("+b(c[1],null)+", "+b(c[2],
null)+")";case "||":return"crox_logical_or("+b(c[1],null)+", "+b(c[2],null)+")";default:throw Error("unknown expr: "+c[0]);}}var f="",c="";g(a[1]);return c="<?php "+c+"?>"}function M(a,d){function g(b){for(var a=0;a<b.length;++a){var d=b[a];switch(d[0]){case "if":var h="#if("+e(d[1])+")";f+=h;g(d[2]);d[3]&&(f+="#{else}",g(d[3]));f+="#{end}";break;case "each":var h=d[3]?"$_"+d[3]:"$k",H="#set ($list = "+e(d[1])+")";f+=H;f+="#foreach($_"+d[4]+" in $list)";d[3]&&(f+="#set("+h+" = $velocityCount - 1)");
g(d[2]);f+="#{end}";break;case "set":d="#set ($_"+d[1]+"="+e(d[2])+")";f+=d;break;case "eval":d=e(d[1]);f=/^\$([\w-]+)$/.test(d)?f+("${"+RegExp.$1+"}"):f+("#set($t = "+d+")$!{t}");break;case "text":d=d[1].replace(/\$/g,"$${dollar}").replace(/#/g,"$${sharp}");f+=d;break;case "inc":d="#parse('"+d[1].replace(/\.\w+$/,".vm")+"')";f+=d;break;default:throw Error("unknown stmt: "+d[0]);}}}function b(b,a){var d=e(b);a&&!a(b[0])&&(d="("+d+")");return d}function e(c){switch(c[0]){case "id":return"$_"+c[1];
case "lit":return"string"==typeof c[1]?(c=c[1],c=-1==c.indexOf("'")?"'"+c+"'":"('"+c.split("'").join("'+\"'\"+'")+"')",c):String(c[1]);case ".":return b(c[1],r)+"."+c[2];case "[]":return b(c[1],r)+"["+e(c[2])+"]";case "!":return"!"+b(c[1],h);case "u-":if("u-"==c[1][0])throw Error("\u7981\u6b62\u4e24\u4e2a\u8d1f\u53f7\u8fde\u7528");return"-"+b(c[1],h);case "*":case "/":case "%":return b(c[1],v)+c[0]+b(c[2],h);case "+":case "-":return b(c[1],w)+c[0]+" "+b(c[2],v);case "<":case ">":case "<=":case ">=":return b(c[1],
x)+c[0]+b(c[2],w);case "eq":case "ne":return b(c[1],z)+("eq"==c[0]?"==":"!=")+b(c[2],x);case "&&":return b(c[1],B)+"&&"+b(c[2],z);case "||":return b(c[1],E)+"||"+b(c[2],B);default:throw Error("unknown expr: "+c[0]);}}d||(d="\r\n");var f="#set($dollar='$')#set($sharp='#')";g(a[1]);return f}y.prototype.toString=function(){return"("+this.row+","+this.col+")"};var K=function(){var a=[[/\s+/,function(){return null}],[/[A-Za-z_]\w*/,function(a){switch(a){case "true":case "false":return"boolean";case "set":case "include":return a;
default:if(-1!=" abstract boolean break byte case catch char class const continue debugger default delete do double else enum export extends final finally float for function goto if implements import in instanceof int interface let long native new package private protected public return short static super switch synchronized this throw throws transient try typeof var void volatile while with yield ".indexOf(" "+a+" ")||"null"==a)throw Error("Reserved: "+a+" "+D(this.source,this.index));return"realId"}}],
[/"(?:[^"\\]|\\[\s\S])*"|'(?:[^'\\]|\\[\s\S])*'/,function(a){return"string"}],[/\d+(?:\.\d+)?(?:e-?\d+)?/,function(a){return"number"}],[function(a){a.sort().reverse();for(var g=0;g<a.length;++g)a[g]=a[g].replace(/[()*+?.[\]|]/g,"\\$&");return RegExp(a.join("|"))}("! % && ( ) * + - . / < <= = > >= [ ] || === !==".split(" ")),function(a){switch(a){case "===":return"eq";case "!==":return"ne";default:return a}}]];return G({"":[[/(?:(?!{{)[\s\S])+/,function(a){return"{{"==a.substring(0,2)?(this.pushState(a),
a):"text"}],[/{{{/,function(a){this.pushState(a);return a}],[/{{(?:\/if|else|\/each)}}/,function(a){return a}],[/{{(?:#(?:if|each)(?=\s))?/,function(a){this.pushState("{{");return a}]],"{{":a.concat([[/}}/,function(a){this.popState();return a}]]),"{{{":a.concat([[/}}}/,function(a){this.popState();return a}]])})}(),J=function(){return function(a){function d(b,a){return f[b][a]}var g=a.nStart,b=a.tSymbols,e=a.tSymbolIndex,f=a.tAction,c=a.tGoto,p=a.tRules,q=a.tFuncs,h=a.actionIndex;h&&(d=function(b,
a){var c=f[h[b]];return c[a]||c._});return function(a,f){function h(b){throw Error("Syntax error: "+a.getPos(m.index)+(b?"\n"+b:""));}var n=0,k=[0],m=a.scan(),t=[],r={get:function(b){return t[t.length+b]},set:function(b,a){t[t.length+b]=a}};if(f)for(var l in f)r[l]=f[l];for(;;)if(l=d(n,e[m.tag]))if(0<l)k.push(n=l),t.push(m),m=a.scan();else if(0>l&&-32768<l){l=-l;var n=p[l],u=n.length-1;k.length-=u;n=c[k[k.length-1]][n[0]-g];k.push(n);q[l]?(l=q[l].apply(r,t.splice(t.length-u,u)),t.push(l)):1!=u&&t.splice(t.length-
u,u,null)}else return m.tag!=b[0]&&h(),t[0];else{l=[];for(u=0;u<g;++u)d(n,u)&&l.push(b[u]);h("find "+m.tag+"\nexpect "+l.join(" "))}}}({nStart:37,tSymbols:"$ ! % && ( ) * + - . / < <= = > >= [ ] boolean eq include ne number realId set string text {{ {{#each {{#if {{/each}} {{/if}} {{else}} {{{ || }} }}} AdditiveExpression EqualityExpression LogicalAndExpression LogicalOrExpression MemberExpression MultiplicativeExpression PrimaryExpression RelationalExpression UnaryExpression epsilon expr id program statement statements".split(" "),
tSymbolIndex:{$:0,"!":1,"%":2,"&&":3,"(":4,")":5,"*":6,"+":7,"-":8,".":9,"/":10,"<":11,"<=":12,"=":13,">":14,">=":15,"[":16,"]":17,"boolean":18,eq:19,include:20,ne:21,number:22,realId:23,set:24,string:25,text:26,"{{":27,"{{#each":28,"{{#if":29,"{{/each}}":30,"{{/if}}":31,"{{else}}":32,"{{{":33,"||":34,"}}":35,"}}}":36,AdditiveExpression:37,EqualityExpression:38,LogicalAndExpression:39,LogicalOrExpression:40,MemberExpression:41,MultiplicativeExpression:42,PrimaryExpression:43,RelationalExpression:44,
UnaryExpression:45,epsilon:46,expr:47,id:48,program:49,statement:50,statements:51},tAction:[{_:-2},{_:-32768},{26:3,27:4,28:5,29:6,33:7,_:-1},{_:-11},{1:9,4:10,8:11,18:12,20:13,22:14,23:15,24:16,25:17,_:0},{1:9,4:10,8:11,18:12,20:29,22:14,23:15,24:30,25:17,_:0},{_:-3},{_:-18},{25:37,_:-15},{_:-17},{_:-13},{20:29,23:15,24:30,_:-14},{_:-16},{7:39,8:40,_:-34},{19:41,21:42,_:-42},{3:43,_:-44},{34:44,_:-46},{9:45,16:46,_:-24},{2:47,6:48,10:49,_:-31},{_:-21},{11:50,12:51,14:52,15:53,_:-39},{_:-27},{35:54,
_:0},{_:-19},{_:-15},{_:-14},{25:55,_:0},{35:56,_:0},{36:57,_:0},{_:-25},{5:58,_:0},{_:-26},{35:59,_:0},{13:60,_:0},{20:29,23:15,24:30,_:0},{_:-9},{25:76,_:-47},{_:-10},{_:-20},{_:-12},{2:47,6:48,10:49,_:-32},{2:47,6:48,10:49,_:-33},{11:50,12:51,14:52,15:53,_:-40},{11:50,12:51,14:52,15:53,_:-41},{19:41,21:42,_:-43},{3:43,_:-45},{_:-22},{17:80,_:0},{_:-30},{_:-28},{_:-29},{7:39,8:40,_:-35},{7:39,8:40,_:-37},{7:39,8:40,_:-36},{7:39,8:40,_:-38},{35:81,_:0},{35:82,_:0},{26:3,27:4,28:5,29:6,31:83,32:84,
33:7,_:0},{35:85,_:0},{_:-23},{_:-4},{_:-8},{26:3,27:4,28:5,29:6,30:89,33:7,_:0},{26:3,27:4,28:5,29:6,30:90,33:7,_:0},{26:3,27:4,28:5,29:6,31:91,33:7,_:0},{_:-7},{_:-6},{_:-5}],actionIndex:[0,1,2,3,4,5,5,5,6,5,5,5,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,5,5,5,5,5,5,34,5,5,5,5,5,5,5,5,35,36,0,37,38,39,5,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,0,0,60,0,61,62,63,64,65,66,67],tGoto:[{12:1,14:2},,{13:8},,{0:18,1:19,2:20,3:21,4:22,5:23,6:24,7:25,
8:26,10:27,11:28},{0:18,1:19,2:20,3:21,4:22,5:23,6:24,7:25,8:26,10:31,11:28},{0:18,1:19,2:20,3:21,4:22,5:23,6:24,7:25,8:26,10:32,11:28},{0:18,1:19,2:20,3:21,4:22,5:23,6:24,7:25,8:26,10:33,11:28},,{4:22,6:24,8:34,11:28},{0:18,1:19,2:20,3:21,4:22,5:23,6:24,7:25,8:26,10:35,11:28},{4:22,6:24,8:36,11:28},,,,,{11:38},,,,,,,,,,,,,,,,,,,,,,,{4:22,5:61,6:24,8:26,11:28},{4:22,5:62,6:24,8:26,11:28},{0:18,4:22,5:23,6:24,7:63,8:26,11:28},{0:18,4:22,5:23,6:24,7:64,8:26,11:28},{0:18,1:65,4:22,5:23,6:24,7:25,8:26,
11:28},{0:18,1:19,2:66,4:22,5:23,6:24,7:25,8:26,11:28},{11:67},{0:18,1:19,2:20,3:21,4:22,5:23,6:24,7:25,8:26,10:68,11:28},{4:22,6:24,8:69,11:28},{4:22,6:24,8:70,11:28},{4:22,6:24,8:71,11:28},{0:72,4:22,5:23,6:24,8:26,11:28},{0:73,4:22,5:23,6:24,8:26,11:28},{0:74,4:22,5:23,6:24,8:26,11:28},{0:75,4:22,5:23,6:24,8:26,11:28},,{9:77},{14:78},,,,{0:18,1:19,2:20,3:21,4:22,5:23,6:24,7:25,8:26,10:79,11:28},,,,,,,,,,,,,,,,,,{13:8},,,{14:86},{14:87},,{14:88},,{13:8},{13:8},{13:8}],tRules:[[52,49],[49,51],[51],
[51,51,50],[50,29,47,35,51,31],[50,29,47,35,51,32,51,31],[50,28,47,25,46,35,51,30],[50,28,47,25,25,35,51,30],[50,27,24,48,13,47,35],[50,27,47,35],[50,33,47,36],[50,26],[50,27,20,25,35],[48,23],[48,24],[48,20],[43,25],[43,22],[43,18],[43,48],[43,4,47,5],[41,43],[41,41,9,48],[41,41,16,47,17],[45,41],[45,1,45],[45,8,45],[42,45],[42,42,6,45],[42,42,10,45],[42,42,2,45],[37,42],[37,37,7,42],[37,37,8,42],[44,37],[44,44,11,37],[44,44,14,37],[44,44,12,37],[44,44,15,37],[38,44],[38,38,19,44],[38,38,21,44],
[39,38],[39,39,3,38],[40,39],[40,40,34,39],[47,40],[46]],tFuncs:function(){function a(b,a,d,c,g,h,r){return["each",a,h,c&&eval(c.text),eval(d.text)]}function d(b){return["lit",eval(b.text)]}function g(b,a,d){return[a.text,b,d]}return[,function(b){return["prog",b]},function(){return[]},function(b,a){b.push(a);return b},function(a,e,d,c,g){return["if",e,c]},function(a,e,d,c,g,h,r){return["if",e,c,h]},a,a,function(a,e,d,c,g,h){return["set",d.text,g]},function(a,d,f){return["eval",d,!0]},function(a,d,
f){return["eval",d,!1]},function(a){return["text",a.text]},function(a,d,f,c){return["inc",eval(f.text)]},,,,d,d,function(a){return["lit","true"==a.text]},function(a){return["id",a.text]},function(a,d,f){return d},,function(a,d,f){return[".",a,f.text]},function(a,d,f,c){return["[]",a,f]},,function(a,d){return["!",d]},function(a,d){return["u-",d]},,g,g,g,,g,g,,g,g,g,g,,function(a,d,f){return["eq",a,f]},function(a,d,f){return["ne",a,f]},,g,,g]}()})}();return{parse:C,compile:F,render:function(a,d){return F(a)(d)},
compileToPhp:function(a){return L(C(a))},compileToVM:function(a,d){return M(C(a))},version:"1.2.0"}}();"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=y:"function"==typeof define&&(define.amd||define.cmd)?define(function(){return y}):"undefined"!=typeof KISSY&&KISSY.add("crox",function(){return y});A&&(A.Crox=y)})(this);
