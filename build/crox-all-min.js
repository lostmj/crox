/*
 Crox v1.2.1
 https://github.com/thx/crox

 Released under the MIT license
 md5: 77263821c96934adb10404730d75ce53
*/
(function(A){var w=function(){function w(a,f){this.row=a;this.col=f}function D(a,f){var d=a.substring(0,f),e=d.match(/\r\n?|\n/g),b=1;e&&(b+=e.length);d=1+/[^\r\n]*$/.exec(d)[0].length;return new w(b,d)}function A(a){return'"'+a.replace(/[\x00-\x1f"\\\u2028\u2029]/g,function(f){switch(f){case '"':return'\\"';case "\\":return"\\\\";case "\b":return"\\b";case "\f":return"\\f";case "\n":return"\\n";case "\r":return"\\r";case "\t":return"\\t"}return"\\u"+("000"+f.charCodeAt(0).toString(16)).slice(-4)})+
'"'}function G(a){function f(b,x,g,c){this.tag=b;this.text=x;this.index=g;this.subMatches=c}function d(){}function e(b){for(var g=1,c=[],e=[1],f=[],a=0;a<b.length;++a)e.push(g+=RegExp("|"+b[a][0].source).exec("").length),f.push(b[a][1]||d),c.push("("+b[a][0].source+")");return[RegExp(c.join("|")+"|","g"),e,f]}f.prototype.toString=function(){return this.text};var b=a.$||"$",g={},c;for(c in a)"$"!=c.charAt(0)&&(g[c]=e(a[c]));return function(c){var x=c.length,e=0,a=[""],d={text:"",index:0,source:c,pushState:function(b){a.push(b)},
popState:function(){a.pop()},retract:function(b){e-=b}};return{scan:function(){do{var p;a:{var q=g[a[a.length-1]],l=q[0];l.lastIndex=e;p=l.exec(c);if(""==p[0]){if(e<x)throw Error("lexer error: "+D(c,e)+"\n"+c.slice(e,e+50));p=new f(b,"",e)}else{d.index=e;e=l.lastIndex;for(var l=q[1],n=0;n<l.length;++n)if(p[l[n]]){q=q[2][n].apply(d,p.slice(l[n],l[n+1]));p=new f(q,p[0],d.index,p.slice(l[n]+1,l[n+1]));break a}p=void 0}}}while(null==p.tag);return p},getPos:function(b){return D(c,b)},reset:function(){e=
0;a=[""]}}}}function r(a){var f;a:{switch(a){case "id":case "lit":f=!0;break a}f=!1}return f||"."==a||"[]"==a}function h(a){return r(a)||"!"==a||"u-"==a}function t(a){if(h(a))return!0;switch(a){case "*":case "/":case "%":return!0}return!1}function u(a){if(t(a))return!0;switch(a){case "+":case "-":return!0}return!1}function v(a){if(u(a))return!0;switch(a){case "<":case ">":case "<=":case ">=":return!0}return!1}function z(a){if(v(a))return!0;switch(a){case "eq":case "ne":return!0}return!1}function B(a){return z(a)||
"&&"==a}function E(a){return B(a)||"||"==a}function H(a,f){function d(b){k+=c+b+"\n"}function e(b){for(var a=0;a<b.length;++a){var k=b[a];switch(k[0]){case "if":d("if("+g(k[1])+"){");c+="\t";e(k[2]);c=c.slice(0,-1);d("}");k[3]&&(d("else{"),c+="\t",e(k[3]),c=c.slice(0,-1),d("}"));break;case "each":var y=k[3]||"$i";d("var $list = "+g(k[1])+";");d("for(var "+y+" in $list) {");c+="\t";d("var "+k[4]+" = $list["+y+"];");e(k[2]);c=c.slice(0,-1);d("}");break;case "set":d("var "+k[1]+"="+g(k[2])+";");break;
case "eval":y=g(k[1]);k[2]&&(y=f+"("+y+")");d("$s += "+y+";");break;case "text":d("$s += "+A(k[1])+";");break;case "inc":break;default:throw Error("unknown stmt: "+k[0]);}}}function b(b,c){var e=g(b);c&&!c(b[0])&&(e="("+e+")");return e}function g(c){switch(c[0]){case "id":return c[1];case "lit":return"string"==typeof c[1]?A(c[1]):String(c[1]);case ".":return b(c[1],r)+"."+c[2];case "[]":return b(c[1],r)+"["+g(c[2])+"]";case "!":return"!"+b(c[1],h);case "u-":return"- "+b(c[1],h);case "*":case "/":case "%":return b(c[1],
t)+c[0]+b(c[2],h);case "+":case "-":return b(c[1],u)+c[0]+" "+b(c[2],t);case "<":case ">":case "<=":case ">=":return b(c[1],v)+c[0]+b(c[2],u);case "eq":case "ne":return b(c[1],z)+("eq"==c[0]?"===":"!==")+b(c[2],v);case "&&":return b(c[1],B)+"&&"+b(c[2],z);case "||":return b(c[1],E)+"||"+b(c[2],B);default:throw Error("unknown expr: "+c[0]);}}var c="\t",k="";e(a[1]);return k}function C(a){return I(J(a))}function F(a,f){var d=C(a),e;f&&(e=f.htmlEncode);var d=H(d,e||"$htmlEncode"),b="";e||(b+="var obj = { '<': '&lt;', '>': '&gt;', '&': '&amp;', '\"': '&quot;' };\n\tfunction $htmlEncode(s) {\n\t\treturn String(s).replace(/[<>&\"]/g, function(c) {\n\t\t\treturn obj[c];\n\t\t});\n\t}");
b=b+"var $s = '';"+d;b+="return $s;";return Function("root",b)}function K(a){function f(g){for(var c=0;c<g.length;++c){var a=g[c];switch(a[0]){case "if":var d="if("+e(a[1])+"){";b+=d;f(a[2]);b+="}";a[3]&&(b+="else{",f(a[3]),b+="}");break;case "each":d=a[3]?"$crox_"+a[3]+"=>":"";d="foreach("+e(a[1])+" as "+d+"$crox_"+a[4]+")";b+=d;b+="{";f(a[2]);b+="}";break;case "set":a="$crox_"+a[1]+" = "+e(a[2])+";";b+=a;break;case "eval":d=e(a[1]);d=a[2]?"crox_encode("+d+")":"crox_ToString("+d+")";b+="echo "+d+
";";break;case "text":d=a[1];/<\?(?:php)?|\?>/.test(d)?(a="echo "+("'"+String(a[1]).replace(/['\\]/g,"\\$&")+"'")+";",b+=a):b+="?>"+d+"<?php ";break;case "inc":a="include '"+a[1].replace(/\.\w+$/,".php")+"';";b+=a;break;default:throw Error("unknown stmt: "+a[0]);}}}function d(b,c){var a=e(b);c&&!c(b[0])&&(a="("+a+")");return a}function e(b){switch(b[0]){case "id":return"$crox_"+b[1];case "lit":return"string"==typeof b[1]?"'"+String(b[1]).replace(/['\\]/g,"\\$&")+"'":String(b[1]);case ".":return d(b[1],
r)+"->"+b[2];case "[]":return d(b[1],r)+"["+e(b[2])+"]";case "!":return"!crox_ToBoolean("+d(b[1],h)+")";case "u-":return"- "+d(b[1],h);case "*":case "/":case "%":return d(b[1],t)+b[0]+d(b[2],h);case "+":return"crox_plus("+d(b[1],null)+", "+d(b[2],null)+")";case "-":return d(b[1],u)+"- "+d(b[2],t);case "<":case ">":case "<=":case ">=":return d(b[1],v)+b[0]+d(b[2],u);case "eq":case "ne":var c="eq"==b[0]?"===":"!==";return d(b[1],z)+c+d(b[2],v);case "&&":return"crox_logical_and("+d(b[1],null)+", "+d(b[2],
null)+")";case "||":return"crox_logical_or("+d(b[1],null)+", "+d(b[2],null)+")";default:throw Error("unknown expr: "+b[0]);}}var b="";f(a[1]);b="?>"==b.slice(0,2)?b.slice(2):"<?php "+b;return b="<?php "==b.slice(-6)?b.slice(0,-6):b+"?>"}function L(a,f){function d(c){for(var a=0;a<c.length;++a){var e=c[a];switch(e[0]){case "if":var f="#if("+b(e[1])+")";g+=f;d(e[2]);e[3]&&(g+="#{else}",d(e[3]));g+="#{end}";break;case "each":f="#set ($list = "+b(e[1])+")";g+=f;g+="#foreach($_"+e[4]+" in $list)";e[3]&&
(g+="#set($_"+e[3]+" = $velocityCount - 1)");d(e[2]);g+="#{end}";break;case "set":e="#set ($"+("root"==e[1]?"crox_root":"_"+e[1])+"="+b(e[2])+")";g+=e;break;case "eval":e=b(e[1]);g=/^\$([\w-]+)$/.test(e)?g+("${"+RegExp.$1+"}"):g+("#set($t = "+e+")$!{t}");break;case "text":e=e[1].replace(/\$/g,"$${dollar}").replace(/#/g,"$${sharp}");g+=e;break;case "inc":e="#parse('"+e[1].replace(/\.\w+$/,".vm")+"')";g+=e;break;default:throw Error("unknown stmt: "+e[0]);}}}function e(c,e){var a=b(c);e&&!e(c[0])&&(a=
"("+a+")");return a}function b(c){switch(c[0]){case "id":return"$"+("root"==c[1]?"crox_root":"_"+c[1]);case "lit":return"string"==typeof c[1]?(c=c[1],c=-1==c.indexOf("'")?"'"+c+"'":"('"+c.split("'").join("'+\"'\"+'")+"')",c):String(c[1]);case ".":return e(c[1],r)+"."+c[2];case "[]":return e(c[1],r)+"["+b(c[2])+"]";case "!":return"!"+e(c[1],h);case "u-":if("u-"==c[1][0])throw Error("\u7981\u6b62\u4e24\u4e2a\u8d1f\u53f7\u8fde\u7528");return"-"+e(c[1],h);case "*":case "/":case "%":return e(c[1],t)+c[0]+
e(c[2],h);case "+":case "-":return e(c[1],u)+c[0]+" "+e(c[2],t);case "<":case ">":case "<=":case ">=":return e(c[1],v)+c[0]+e(c[2],u);case "eq":case "ne":return e(c[1],z)+("eq"==c[0]?"==":"!=")+e(c[2],v);case "&&":return e(c[1],B)+"&&"+e(c[2],z);case "||":return e(c[1],E)+"||"+e(c[2],B);default:throw Error("unknown expr: "+c[0]);}}f||(f="\r\n");var g="#set($dollar='$')#set($sharp='#')";d(a[1]);return g}w.prototype.toString=function(){return"("+this.row+","+this.col+")"};var J=function(){var a=[[/\s+/,
function(){return null}],[/[A-Za-z_]\w*/,function(a){switch(a){case "true":case "false":return"boolean";case "set":case "include":return a;default:if(-1!=" abstract boolean break byte case catch char class const continue debugger default delete do double else enum export extends final finally float for function goto if implements import in instanceof int interface let long native new package private protected public return short static super switch synchronized this throw throws transient try typeof var void volatile while with yield ".indexOf(" "+
a+" ")||"null"==a)throw Error("Reserved: "+a+" "+D(this.source,this.index));return"realId"}}],[/"(?:[^"\\]|\\[\s\S])*"|'(?:[^'\\]|\\[\s\S])*'/,function(a){return"string"}],[/\d+(?:\.\d+)?(?:e-?\d+)?/,function(a){return"number"}],[function(a){a.sort().reverse();for(var d=0;d<a.length;++d)a[d]=a[d].replace(/[()*+?.[\]|]/g,"\\$&");return RegExp(a.join("|"))}("! % && ( ) * + - . / < <= = > >= [ ] || === !==".split(" ")),function(a){switch(a){case "===":return"eq";case "!==":return"ne";default:return a}}]];
return G({"":[[/(?:(?!{{)[\s\S])+/,function(a){return"{{"==a.substring(0,2)?(this.pushState(a),a):"text"}],[/{{{/,function(a){this.pushState(a);return a}],[/{{(?:\/if|else|\/each)}}/,function(a){return a}],[/{{(?:#(?:if|each)(?=\s))?/,function(a){this.pushState("{{");return a}]],"{{":a.concat([[/}}/,function(a){this.popState();return a}]]),"{{{":a.concat([[/}}}/,function(a){this.popState();return a}]])})}(),I=function(){return function(a){function f(b,a){return g[b][a]}var d=a.nStart,e=a.tSymbols,
b=a.tSymbolIndex,g=a.tAction,c=a.tGoto,k=a.tRules,x=a.tFuncs,h=a.actionIndex;h&&(f=function(b,a){var c=g[h[b]];return c[a]||c._});return function(a,g){function p(b){throw Error("Syntax error: "+a.getPos(n.index)+(b?"\n"+b:""));}var q=0,l=[0],n=a.scan(),h=[],r={get:function(a){return h[h.length+a]},set:function(a,b){h[h.length+a]=b}};if(g)for(var m in g)r[m]=g[m];for(;;)if(m=f(q,b[n.tag]))if(0<m)l.push(q=m),h.push(n),n=a.scan();else if(0>m&&-32768<m){m=-m;var q=k[m],s=q.length-1;l.length-=s;q=c[l[l.length-
1]][q[0]-d];l.push(q);x[m]?(m=x[m].apply(r,h.splice(h.length-s,s)),h.push(m)):1!=s&&h.splice(h.length-s,s,null)}else return n.tag!=e[0]&&p(),h[0];else{m=[];for(s=0;s<d;++s)f(q,s)&&m.push(e[s]);p("find "+n.tag+"\nexpect "+m.join(" "))}}}({nStart:37,tSymbols:"$ ! % && ( ) * + - . / < <= = > >= [ ] boolean eq include ne number realId set string text {{ {{#each {{#if {{/each}} {{/if}} {{else}} {{{ || }} }}} AdditiveExpression EqualityExpression LogicalAndExpression LogicalOrExpression MemberExpression MultiplicativeExpression PrimaryExpression RelationalExpression UnaryExpression epsilon expr id program statement statements".split(" "),
tSymbolIndex:{$:0,"!":1,"%":2,"&&":3,"(":4,")":5,"*":6,"+":7,"-":8,".":9,"/":10,"<":11,"<=":12,"=":13,">":14,">=":15,"[":16,"]":17,"boolean":18,eq:19,include:20,ne:21,number:22,realId:23,set:24,string:25,text:26,"{{":27,"{{#each":28,"{{#if":29,"{{/each}}":30,"{{/if}}":31,"{{else}}":32,"{{{":33,"||":34,"}}":35,"}}}":36,AdditiveExpression:37,EqualityExpression:38,LogicalAndExpression:39,LogicalOrExpression:40,MemberExpression:41,MultiplicativeExpression:42,PrimaryExpression:43,RelationalExpression:44,
UnaryExpression:45,epsilon:46,expr:47,id:48,program:49,statement:50,statements:51},tAction:[{_:-2},{_:-32768},{26:3,27:4,28:5,29:6,33:7,_:-1},{_:-11},{1:9,4:10,8:11,18:12,20:13,22:14,23:15,24:16,25:17,_:0},{1:9,4:10,8:11,18:12,20:29,22:14,23:15,24:30,25:17,_:0},{_:-3},{_:-18},{25:37,_:-15},{_:-17},{_:-13},{20:29,23:15,24:30,_:-14},{_:-16},{7:39,8:40,_:-34},{19:41,21:42,_:-42},{3:43,_:-44},{34:44,_:-46},{9:45,16:46,_:-24},{2:47,6:48,10:49,_:-31},{_:-21},{11:50,12:51,14:52,15:53,_:-39},{_:-27},{35:54,
_:0},{_:-19},{_:-15},{_:-14},{25:55,_:0},{35:56,_:0},{36:57,_:0},{_:-25},{5:58,_:0},{_:-26},{35:59,_:0},{13:60,_:0},{20:29,23:15,24:30,_:0},{_:-9},{25:76,_:-47},{_:-10},{_:-20},{_:-12},{2:47,6:48,10:49,_:-32},{2:47,6:48,10:49,_:-33},{11:50,12:51,14:52,15:53,_:-40},{11:50,12:51,14:52,15:53,_:-41},{19:41,21:42,_:-43},{3:43,_:-45},{_:-22},{17:80,_:0},{_:-30},{_:-28},{_:-29},{7:39,8:40,_:-35},{7:39,8:40,_:-37},{7:39,8:40,_:-36},{7:39,8:40,_:-38},{35:81,_:0},{35:82,_:0},{26:3,27:4,28:5,29:6,31:83,32:84,
33:7,_:0},{35:85,_:0},{_:-23},{_:-4},{_:-8},{26:3,27:4,28:5,29:6,30:89,33:7,_:0},{26:3,27:4,28:5,29:6,30:90,33:7,_:0},{26:3,27:4,28:5,29:6,31:91,33:7,_:0},{_:-7},{_:-6},{_:-5}],actionIndex:[0,1,2,3,4,5,5,5,6,5,5,5,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,5,5,5,5,5,5,34,5,5,5,5,5,5,5,5,35,36,0,37,38,39,5,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,0,0,60,0,61,62,63,64,65,66,67],tGoto:[{12:1,14:2},,{13:8},,{0:18,1:19,2:20,3:21,4:22,5:23,6:24,7:25,
8:26,10:27,11:28},{0:18,1:19,2:20,3:21,4:22,5:23,6:24,7:25,8:26,10:31,11:28},{0:18,1:19,2:20,3:21,4:22,5:23,6:24,7:25,8:26,10:32,11:28},{0:18,1:19,2:20,3:21,4:22,5:23,6:24,7:25,8:26,10:33,11:28},,{4:22,6:24,8:34,11:28},{0:18,1:19,2:20,3:21,4:22,5:23,6:24,7:25,8:26,10:35,11:28},{4:22,6:24,8:36,11:28},,,,,{11:38},,,,,,,,,,,,,,,,,,,,,,,{4:22,5:61,6:24,8:26,11:28},{4:22,5:62,6:24,8:26,11:28},{0:18,4:22,5:23,6:24,7:63,8:26,11:28},{0:18,4:22,5:23,6:24,7:64,8:26,11:28},{0:18,1:65,4:22,5:23,6:24,7:25,8:26,
11:28},{0:18,1:19,2:66,4:22,5:23,6:24,7:25,8:26,11:28},{11:67},{0:18,1:19,2:20,3:21,4:22,5:23,6:24,7:25,8:26,10:68,11:28},{4:22,6:24,8:69,11:28},{4:22,6:24,8:70,11:28},{4:22,6:24,8:71,11:28},{0:72,4:22,5:23,6:24,8:26,11:28},{0:73,4:22,5:23,6:24,8:26,11:28},{0:74,4:22,5:23,6:24,8:26,11:28},{0:75,4:22,5:23,6:24,8:26,11:28},,{9:77},{14:78},,,,{0:18,1:19,2:20,3:21,4:22,5:23,6:24,7:25,8:26,10:79,11:28},,,,,,,,,,,,,,,,,,{13:8},,,{14:86},{14:87},,{14:88},,{13:8},{13:8},{13:8}],tRules:[[52,49],[49,51],[51],
[51,51,50],[50,29,47,35,51,31],[50,29,47,35,51,32,51,31],[50,28,47,25,46,35,51,30],[50,28,47,25,25,35,51,30],[50,27,24,48,13,47,35],[50,27,47,35],[50,33,47,36],[50,26],[50,27,20,25,35],[48,23],[48,24],[48,20],[43,25],[43,22],[43,18],[43,48],[43,4,47,5],[41,43],[41,41,9,48],[41,41,16,47,17],[45,41],[45,1,45],[45,8,45],[42,45],[42,42,6,45],[42,42,10,45],[42,42,2,45],[37,42],[37,37,7,42],[37,37,8,42],[44,37],[44,44,11,37],[44,44,14,37],[44,44,12,37],[44,44,15,37],[38,44],[38,38,19,44],[38,38,21,44],
[39,38],[39,39,3,38],[40,39],[40,40,34,39],[47,40],[46]],tFuncs:function(){function a(a,b,d,c,f,h,r){return["each",b,h,c&&eval(c.text),eval(d.text)]}function f(a){return["lit",eval(a.text)]}function d(a,b,d){return[b.text,a,d]}return[,function(a){return["prog",a]},function(){return[]},function(a,b){a.push(b);return a},function(a,b,d,c,f){return["if",b,c]},function(a,b,d,c,f,h,r){return["if",b,c,h]},a,a,function(a,b,d,c,f,h){return["set",d.text,f]},function(a,b,d){return["eval",b,!0]},function(a,b,
d){return["eval",b,!1]},function(a){return["text",a.text]},function(a,b,d,c){return["inc",eval(d.text)]},,,,f,f,function(a){return["lit","true"==a.text]},function(a){return["id",a.text]},function(a,b,d){return b},,function(a,b,d){return[".",a,d.text]},function(a,b,d,c){return["[]",a,d]},,function(a,b){return["!",b]},function(a,b){return["u-",b]},,d,d,d,,d,d,,d,d,d,d,,function(a,b,d){return["eq",a,d]},function(a,b,d){return["ne",a,d]},,d,,d]}()})}();return{parse:C,compile:F,render:function(a,f){return F(a)(f)},
compileToPhp:function(a){return K(C(a))},compileToVM:function(a,f){return L(C(a))},version:"1.2.1"}}();"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=w:"function"==typeof define&&(define.amd||define.cmd)?define(function(){return w}):"undefined"!=typeof KISSY&&KISSY.add(function(){return w});A&&(A.Crox=w)})(this);
