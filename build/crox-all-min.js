/*
 Crox v1.2.1
 https://github.com/thx/crox

 Released under the MIT license
 md5: 3b923d4c344ccadd2e409552a5283301
*/
(function(A){var x=function(){function x(a,d){this.row=a;this.col=d}function D(a,d){var c=a.substring(0,d),f=c.match(/\r\n?|\n/g),b=1;f&&(b+=f.length);c=1+/[^\r\n]*$/.exec(c)[0].length;return new x(b,c)}function A(a){return'"'+a.replace(/[\x00-\x1f"\\\u2028\u2029]/g,function(d){switch(d){case '"':return'\\"';case "\\":return"\\\\";case "\b":return"\\b";case "\f":return"\\f";case "\n":return"\\n";case "\r":return"\\r";case "\t":return"\\t"}return"\\u"+("000"+d.charCodeAt(0).toString(16)).slice(-4)})+
'"'}function G(a){function d(b,k,c,d){this.tag=b;this.text=k;this.index=c;this.subMatches=d}function c(){}function f(b){for(var k=1,d=[],a=[1],f=[],g=0;g<b.length;++g)a.push(k+=RegExp("|"+b[g][0].source).exec("").length),f.push(b[g][1]||c),d.push("("+b[g][0].source+")");return[RegExp(d.join("|")+"|","g"),a,f]}d.prototype.toString=function(){return this.text};var b=a.$||"$",k={},g;for(g in a)"$"!=g.charAt(0)&&(k[g]=f(a[g]));return function(e){var c=e.length,a=0,f=[""],g={text:"",index:0,source:e,pushState:function(b){f.push(b)},
popState:function(){f.pop()},retract:function(b){a-=b}};return{scan:function(){do{var q;a:{var r=k[f[f.length-1]],l=r[0];l.lastIndex=a;q=l.exec(e);if(""==q[0]){if(a<c)throw Error("lexer error: "+D(e,a)+"\n"+e.slice(a,a+50));q=new d(b,"",a)}else{g.index=a;a=l.lastIndex;for(var l=r[1],p=0;p<l.length;++p)if(q[l[p]]){r=r[2][p].apply(g,q.slice(l[p],l[p+1]));q=new d(r,q[0],g.index,q.slice(l[p]+1,l[p+1]));break a}q=void 0}}}while(null==q.tag);return q},getPos:function(b){return D(e,b)},reset:function(){a=
0;f=[""]}}}}function s(a){var d;a:{switch(a){case "id":case "lit":d=!0;break a}d=!1}return d||"."==a||"[]"==a}function h(a){return s(a)||"!"==a||"u-"==a}function u(a){if(h(a))return!0;switch(a){case "*":case "/":case "%":return!0}return!1}function v(a){if(u(a))return!0;switch(a){case "+":case "-":return!0}return!1}function w(a){if(v(a))return!0;switch(a){case "<":case ">":case "<=":case ">=":return!0}return!1}function z(a){if(w(a))return!0;switch(a){case "eq":case "ne":return!0}return!1}function B(a){return z(a)||
"&&"==a}function E(a){return B(a)||"||"==a}function H(a,d){function c(b){e+=g+b+"\n"}function f(b){for(var e=0;e<b.length;++e){var a=b[e];switch(a[0]){case "if":c("if("+k(a[1])+"){");g+="\t";f(a[2]);g=g.slice(0,-1);c("}");a[3]&&(c("else{"),g+="\t",f(a[3]),g=g.slice(0,-1),c("}"));break;case "each":var y=a[3]||"$i";c("var $list = "+k(a[1])+";");c("for(var "+y+" in $list) {");g+="\t";c("var "+a[4]+" = $list["+y+"];");f(a[2]);g=g.slice(0,-1);c("}");break;case "set":c("var "+a[1]+"="+k(a[2])+";");break;
case "eval":y=k(a[1]);a[2]&&(y=d+"("+y+")");c("$s += "+y+";");break;case "text":c("$s += "+A(a[1])+";");break;case "inc":break;case "raw":c(a[1]);break;default:throw Error("unknown stmt: "+a[0]);}}}function b(b,a){var e=k(b);a&&!a(b[0])&&(e="("+e+")");return e}function k(a){switch(a[0]){case "id":return a[1];case "lit":return"string"==typeof a[1]?A(a[1]):String(a[1]);case ".":return b(a[1],s)+"."+a[2];case "[]":return b(a[1],s)+"["+k(a[2])+"]";case "!":return"!"+b(a[1],h);case "u-":return"- "+b(a[1],
h);case "*":case "/":case "%":return b(a[1],u)+a[0]+b(a[2],h);case "+":case "-":return b(a[1],v)+a[0]+" "+b(a[2],u);case "<":case ">":case "<=":case ">=":return b(a[1],w)+a[0]+b(a[2],v);case "eq":case "ne":return b(a[1],z)+("eq"==a[0]?"===":"!==")+b(a[2],w);case "&&":return b(a[1],B)+"&&"+b(a[2],z);case "||":return b(a[1],E)+"||"+b(a[2],B);default:throw Error("unknown expr: "+a[0]);}}var g="\t",e="";f(a[1]);return e}function C(a){return I(J(a))}function F(a,d){var c=C(a),f;d&&(f=d.htmlEncode);var c=
H(c,f||"$htmlEncode"),b="";f||(b+="var obj = { '<': '&lt;', '>': '&gt;', '&': '&amp;', '\"': '&quot;' };\n\tfunction $htmlEncode(s) {\n\t\treturn String(s).replace(/[<>&\"]/g, function(c) {\n\t\t\treturn obj[c];\n\t\t});\n\t}");b=b+"var $s = '';"+c;b+="return $s;";return Function("root",b)}function K(a){function d(a){for(var c=0;c<a.length;++c){var e=a[c];switch(e[0]){case "if":var n="if("+f(e[1])+"){";b+=n;d(e[2]);b+="}";e[3]&&(b+="else{",d(e[3]),b+="}");break;case "each":n=e[3]?"$crox_"+e[3]+"=>":
"";n="foreach("+f(e[1])+" as "+n+"$crox_"+e[4]+")";b+=n;b+="{";d(e[2]);b+="}";break;case "set":e="$crox_"+e[1]+" = "+f(e[2])+";";b+=e;break;case "eval":n=f(e[1]);n=e[2]?"crox_encode("+n+")":"crox_ToString("+n+")";b+="echo "+n+";";break;case "text":n=e[1];/<\?(?:php)?|\?>/.test(n)?(e="echo "+("'"+String(e[1]).replace(/['\\]/g,"\\$&")+"'")+";",b+=e):b+="?>"+n+"<?php ";break;case "inc":e="include '"+e[1].replace(/\.\w+$/,".php")+"';";b+=e;break;case "raw":b+=e[1];break;default:throw Error("unknown stmt: "+
e[0]);}}}function c(a,b){var e=f(a);b&&!b(a[0])&&(e="("+e+")");return e}function f(a){switch(a[0]){case "id":return"$crox_"+a[1];case "lit":return"string"==typeof a[1]?"'"+String(a[1]).replace(/['\\]/g,"\\$&")+"'":String(a[1]);case ".":return c(a[1],s)+"->"+a[2];case "[]":return c(a[1],s)+"["+f(a[2])+"]";case "!":return"!crox_ToBoolean("+c(a[1],h)+")";case "u-":return"- "+c(a[1],h);case "*":case "/":case "%":return c(a[1],u)+a[0]+c(a[2],h);case "+":return"crox_plus("+c(a[1],null)+", "+c(a[2],null)+
")";case "-":return c(a[1],v)+"- "+c(a[2],u);case "<":case ">":case "<=":case ">=":return c(a[1],w)+a[0]+c(a[2],v);case "eq":case "ne":var b="eq"==a[0]?"===":"!==";return c(a[1],z)+b+c(a[2],w);case "&&":return"crox_logical_and("+c(a[1],null)+", "+c(a[2],null)+")";case "||":return"crox_logical_or("+c(a[1],null)+", "+c(a[2],null)+")";default:throw Error("unknown expr: "+a[0]);}}var b="";d(a[1]);b="?>"==b.slice(0,2)?b.slice(2):"<?php "+b;return b="<?php "==b.slice(-6)?b.slice(0,-6):b+"?>"}function L(a,
d){function c(a){g+=a}function f(a){for(var b=0;b<a.length;++b){var d=a[b];switch(d[0]){case "if":c("#if("+k(d[1])+")");f(d[2]);d[3]&&(c("#{else}"),f(d[3]));c("#{end}");break;case "each":c("#set ($list = "+k(d[1])+")");c("#foreach($_"+d[4]+" in $list)");d[3]&&c("#set($_"+d[3]+" = $velocityCount - 1)");f(d[2]);c("#{end}");break;case "set":c("#set ($"+("root"==d[1]?"crox_root":"_"+d[1])+"="+k(d[2])+")");break;case "eval":d=k(d[1]);/^\$([\w-]+)$/.test(d)?c("${"+RegExp.$1+"}"):c("#set($t = "+d+")$!{t}");
break;case "text":c(d[1].replace(/\$/g,"$${dollar}").replace(/#/g,"$${sharp}"));break;case "inc":c("#parse('"+d[1].replace(/\.\w+$/,".vm")+"')");break;case "raw":c(d[1]);break;default:throw Error("unknown stmt: "+d[0]);}}}function b(a,b){var d=k(a);b&&!b(a[0])&&(d="("+d+")");return d}function k(a){switch(a[0]){case "id":return"$"+("root"==a[1]?"crox_root":"_"+a[1]);case "lit":return"string"==typeof a[1]?(a=a[1],a=-1==a.indexOf("'")?"'"+a+"'":"('"+a.split("'").join("'+\"'\"+'")+"')",a):String(a[1]);
case ".":return b(a[1],s)+"."+a[2];case "[]":return b(a[1],s)+"["+k(a[2])+"]";case "!":return"!"+b(a[1],h);case "u-":if("u-"==a[1][0])throw Error("\u7981\u6b62\u4e24\u4e2a\u8d1f\u53f7\u8fde\u7528");return"-"+b(a[1],h);case "*":case "/":case "%":return b(a[1],u)+a[0]+b(a[2],h);case "+":case "-":return b(a[1],v)+a[0]+" "+b(a[2],u);case "<":case ">":case "<=":case ">=":return b(a[1],w)+a[0]+b(a[2],v);case "eq":case "ne":return b(a[1],z)+("eq"==a[0]?"==":"!=")+b(a[2],w);case "&&":return b(a[1],B)+"&&"+
b(a[2],z);case "||":return b(a[1],E)+"||"+b(a[2],B);default:throw Error("unknown expr: "+a[0]);}}d||(d="\r\n");var g="#set($dollar='$')#set($sharp='#')";f(a[1]);return g}x.prototype.toString=function(){return"("+this.row+","+this.col+")"};var J=function(){var a=[[/\s+/,function(){return null}],[/[A-Za-z_]\w*/,function(a){switch(a){case "true":case "false":return"boolean";case "set":case "include":return a;default:if(-1!=" abstract boolean break byte case catch char class const continue debugger default delete do double else enum export extends final finally float for function goto if implements import in instanceof int interface let long native new package private protected public return short static super switch synchronized this throw throws transient try typeof var void volatile while with yield ".indexOf(" "+
a+" ")||"null"==a)throw Error("Reserved: "+a+" "+D(this.source,this.index));return"realId"}}],[/"(?:[^"\\]|\\[\s\S])*"|'(?:[^'\\]|\\[\s\S])*'/,function(a){return"string"}],[/\d+(?:\.\d+)?(?:e-?\d+)?/,function(a){return"number"}],[function(a){a.sort().reverse();for(var c=0;c<a.length;++c)a[c]=a[c].replace(/[()*+?.[\]|]/g,"\\$&");return RegExp(a.join("|"))}("! % && ( ) * + - . / < <= = > >= [ ] || === !==".split(" ")),function(a){switch(a){case "===":return"eq";case "!==":return"ne";default:return a}}]];
return G({"":[[/(?:(?!{{)[\s\S])+/,function(a){return"{{"==a.substring(0,2)?(this.pushState(a),a):"text"}],[/{{{/,function(a){this.pushState(a);return a}],[/{{(?:\/if|else|\/each|\/raw)}}/,function(a){return a}],[/{{#raw}}/,function(a){this.pushState("raw");return a}],[/{{(?:#(?:if|each)(?=\s))?/,function(a){this.pushState("{{");return a}]],raw:[[/(?:(?!{{\/raw}})[\s\S])+/,function(a){this.popState();return"rawtext"}]],"{{":a.concat([[/}}/,function(a){this.popState();return a}]]),"{{{":a.concat([[/}}}/,
function(a){this.popState();return a}]])})}(),I=function(){return function(a){function d(a,b){return k[a][b]}var c=a.nStart,f=a.tSymbols,b=a.tSymbolIndex,k=a.tAction,g=a.tGoto,e=a.tRules,n=a.tFuncs,h=a.actionIndex;h&&(d=function(a,b){var c=k[h[a]];return c[b]||c._});return function(a,k){function q(b){throw Error("Syntax error: "+a.getPos(p.index)+(b?"\n"+b:""));}var r=0,l=[0],p=a.scan(),h=[],s={get:function(a){return h[h.length+a]},set:function(a,b){h[h.length+a]=b}};if(k)for(var m in k)s[m]=k[m];
for(;;)if(m=d(r,b[p.tag]))if(0<m)l.push(r=m),h.push(p),p=a.scan();else if(0>m&&-32768<m){m=-m;var r=e[m],t=r.length-1;l.length-=t;r=g[l[l.length-1]][r[0]-c];l.push(r);n[m]?(m=n[m].apply(s,h.splice(h.length-t,t)),h.push(m)):1!=t&&h.splice(h.length-t,t,null)}else return p.tag!=f[0]&&q(),h[0];else{m=[];for(t=0;t<c;++t)d(r,t)&&m.push(f[t]);q("find "+p.tag+"\nexpect "+m.join(" "))}}}({nStart:40,tSymbols:"$ ! % && ( ) * + - . / < <= = > >= [ ] boolean eq include ne number rawtext realId set string text {{ {{#each {{#if {{#raw}} {{/each}} {{/if}} {{/raw}} {{else}} {{{ || }} }}} AdditiveExpression EqualityExpression LogicalAndExpression LogicalOrExpression MemberExpression MultiplicativeExpression PrimaryExpression RelationalExpression UnaryExpression epsilon expr id program statement statements".split(" "),
tSymbolIndex:{$:0,"!":1,"%":2,"&&":3,"(":4,")":5,"*":6,"+":7,"-":8,".":9,"/":10,"<":11,"<=":12,"=":13,">":14,">=":15,"[":16,"]":17,"boolean":18,eq:19,include:20,ne:21,number:22,rawtext:23,realId:24,set:25,string:26,text:27,"{{":28,"{{#each":29,"{{#if":30,"{{#raw}}":31,"{{/each}}":32,"{{/if}}":33,"{{/raw}}":34,"{{else}}":35,"{{{":36,"||":37,"}}":38,"}}}":39,AdditiveExpression:40,EqualityExpression:41,LogicalAndExpression:42,LogicalOrExpression:43,MemberExpression:44,MultiplicativeExpression:45,PrimaryExpression:46,
RelationalExpression:47,UnaryExpression:48,epsilon:49,expr:50,id:51,program:52,statement:53,statements:54},tAction:[{_:-2},{_:-32768},{27:3,28:4,29:5,30:6,31:7,36:8,_:-1},{_:-11},{1:10,4:11,8:12,18:13,20:14,22:15,24:16,25:17,26:18,_:0},{1:10,4:11,8:12,18:13,20:30,22:15,24:16,25:31,26:18,_:0},{23:34,_:0},{_:-3},{_:-19},{26:39,_:-16},{_:-18},{_:-14},{20:30,24:16,25:31,_:-15},{_:-17},{7:41,8:42,_:-35},{19:43,21:44,_:-43},{3:45,_:-45},{37:46,_:-47},{9:47,16:48,_:-25},{2:49,6:50,10:51,_:-32},{_:-22},{11:52,
12:53,14:54,15:55,_:-40},{_:-28},{38:56,_:0},{_:-20},{_:-16},{_:-15},{26:57,_:0},{38:58,_:0},{34:59,_:0},{39:60,_:0},{_:-26},{5:61,_:0},{_:-27},{38:62,_:0},{13:63,_:0},{20:30,24:16,25:31,_:0},{_:-9},{26:79,_:-48},{_:-13},{_:-10},{_:-21},{_:-12},{2:49,6:50,10:51,_:-33},{2:49,6:50,10:51,_:-34},{11:52,12:53,14:54,15:55,_:-41},{11:52,12:53,14:54,15:55,_:-42},{19:43,21:44,_:-44},{3:45,_:-46},{_:-23},{17:83,_:0},{_:-31},{_:-29},{_:-30},{7:41,8:42,_:-36},{7:41,8:42,_:-38},{7:41,8:42,_:-37},{7:41,8:42,_:-39},
{38:84,_:0},{38:85,_:0},{27:3,28:4,29:5,30:6,31:7,33:86,35:87,36:8,_:0},{38:88,_:0},{_:-24},{_:-4},{_:-8},{27:3,28:4,29:5,30:6,31:7,32:92,36:8,_:0},{27:3,28:4,29:5,30:6,31:7,32:93,36:8,_:0},{27:3,28:4,29:5,30:6,31:7,33:94,36:8,_:0},{_:-7},{_:-6},{_:-5}],actionIndex:[0,1,2,3,4,5,5,6,5,7,5,5,5,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,5,5,5,5,5,5,36,5,5,5,5,5,5,5,5,37,38,0,39,40,41,42,5,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,0,0,63,0,64,65,
66,67,68,69,70],tGoto:[{12:1,14:2},,{13:9},,{0:19,1:20,2:21,3:22,4:23,5:24,6:25,7:26,8:27,10:28,11:29},{0:19,1:20,2:21,3:22,4:23,5:24,6:25,7:26,8:27,10:32,11:29},{0:19,1:20,2:21,3:22,4:23,5:24,6:25,7:26,8:27,10:33,11:29},,{0:19,1:20,2:21,3:22,4:23,5:24,6:25,7:26,8:27,10:35,11:29},,{4:23,6:25,8:36,11:29},{0:19,1:20,2:21,3:22,4:23,5:24,6:25,7:26,8:27,10:37,11:29},{4:23,6:25,8:38,11:29},,,,,{11:40},,,,,,,,,,,,,,,,,,,,,,,,{4:23,5:64,6:25,8:27,11:29},{4:23,5:65,6:25,8:27,11:29},{0:19,4:23,5:24,6:25,7:66,
8:27,11:29},{0:19,4:23,5:24,6:25,7:67,8:27,11:29},{0:19,1:68,4:23,5:24,6:25,7:26,8:27,11:29},{0:19,1:20,2:69,4:23,5:24,6:25,7:26,8:27,11:29},{11:70},{0:19,1:20,2:21,3:22,4:23,5:24,6:25,7:26,8:27,10:71,11:29},{4:23,6:25,8:72,11:29},{4:23,6:25,8:73,11:29},{4:23,6:25,8:74,11:29},{0:75,4:23,5:24,6:25,8:27,11:29},{0:76,4:23,5:24,6:25,8:27,11:29},{0:77,4:23,5:24,6:25,8:27,11:29},{0:78,4:23,5:24,6:25,8:27,11:29},,{9:80},{14:81},,,,,{0:19,1:20,2:21,3:22,4:23,5:24,6:25,7:26,8:27,10:82,11:29},,,,,,,,,,,,,,
,,,,{13:9},,,{14:89},{14:90},,{14:91},,{13:9},{13:9},{13:9}],tRules:[[55,52],[52,54],[54],[54,54,53],[53,30,50,38,54,33],[53,30,50,38,54,35,54,33],[53,29,50,26,49,38,54,32],[53,29,50,26,26,38,54,32],[53,28,25,51,13,50,38],[53,28,50,38],[53,36,50,39],[53,27],[53,28,20,26,38],[53,31,23,34],[51,24],[51,25],[51,20],[46,26],[46,22],[46,18],[46,51],[46,4,50,5],[44,46],[44,44,9,51],[44,44,16,50,17],[48,44],[48,1,48],[48,8,48],[45,48],[45,45,6,48],[45,45,10,48],[45,45,2,48],[40,45],[40,40,7,45],[40,40,8,
45],[47,40],[47,47,11,40],[47,47,14,40],[47,47,12,40],[47,47,15,40],[41,47],[41,41,19,47],[41,41,21,47],[42,41],[42,42,3,41],[43,42],[43,43,37,42],[50,43],[49]],tFuncs:function(){function a(a,b,c,d,e,h,s){return["each",b,h,d&&eval(d.text),eval(c.text)]}function d(a){return["lit",eval(a.text)]}function c(a,b,c){return[b.text,a,c]}return[,function(a){return["prog",a]},function(){return[]},function(a,b){a.push(b);return a},function(a,b,c,d,e){return["if",b,d]},function(a,b,c,d,e,h,s){return["if",b,d,
h]},a,a,function(a,b,c,d,e,h){return["set",c.text,e]},function(a,b,c){return["eval",b,!0]},function(a,b,c){return["eval",b,!1]},function(a){return["text",a.text]},function(a,b,c,d){return["inc",eval(c.text)]},function(a,b,c){return["raw",b.text]},,,,d,d,function(a){return["lit","true"==a.text]},function(a){return["id",a.text]},function(a,b,c){return b},,function(a,b,c){return[".",a,c.text]},function(a,b,c,d){return["[]",a,c]},,function(a,b){return["!",b]},function(a,b){return["u-",b]},,c,c,c,,c,c,
,c,c,c,c,,function(a,b,c){return["eq",a,c]},function(a,b,c){return["ne",a,c]},,c,,c]}()})}();return{parse:C,compile:F,render:function(a,d){return F(a)(d)},compileToPhp:function(a){return K(C(a))},compileToVM:function(a,d){return L(C(a))},version:"1.2.1"}}();"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=x:"function"==typeof define&&(define.amd||define.cmd)?define(function(){return x}):"undefined"!=typeof KISSY&&KISSY.add(function(){return x});A&&(A.Crox=x)})(this);
